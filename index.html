<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Journal Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, updateDoc, onSnapshot, deleteDoc, query, orderBy, writeBatch, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyADD7hRJUGKdkuIiLZHK96wHSmz0FDMyWI",
            authDomain: "jurnal-data-id.firebaseapp.com",
            projectId: "jurnal-data-id",
            storageBucket: "jurnal-data-id.firebasestorage.app",
            messagingSenderId: "361080177174",
            appId: "1:361080177174:web:4a532541bf366f5328ab37",
            measurementId: "G-BL6H435904"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let accountData = null;
        let unsubscribeTrades = null;
        let allTrades = [];
        let currentCalendarDate = new Date();
        let selectedImageBase64 = null;
        let editingTradeId = null;

        const getEl = (id) => document.getElementById(id);

        window.toggleAuthMode = () => {
            const isLogin = getEl('auth-title').innerText === 'LOGIN';
            getEl('auth-title').innerText = isLogin ? 'REGISTER' : 'LOGIN';
            getEl('auth-submit-btn').innerText = isLogin ? 'BUAT AKUN' : 'MASUK';
            getEl('auth-toggle-text').innerText = isLogin ? 'Sudah punya akun? Login' : 'Belum punya akun? Daftar';
        };

        window.togglePassword = (id, iconId) => {
            const input = getEl(id);
            const icon = getEl(iconId);
            if (input.type === 'password') {
                input.type = 'text';
                icon.setAttribute('data-lucide', 'eye-off');
            } else {
                input.type = 'password';
                icon.setAttribute('data-lucide', 'eye');
            }
            lucide.createIcons();
        };

        function showSection(id) {
            const sectionIds = ['auth-section', 'account-section', 'dashboard-section', 'journal-section', 'recap-section'];
            sectionIds.forEach(sid => {
                const el = getEl(sid);
                if (el) el.classList.add('hidden');
            });
            
            const target = getEl(id);
            if (target) target.classList.remove('hidden');

            const nav = getEl('main-nav');
            if (nav) {
                const isAuth = id === 'auth-section' || id === 'account-section';
                nav.classList.toggle('hidden', isAuth);
            }

            if (id === 'journal-section') setDefaultDate();
            if (id === 'recap-section') renderCalendar();
        }

        function setDefaultDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const dateInput = getEl('t-date');
            if (dateInput && !editingTradeId) dateInput.value = `${year}-${month}-${day}`;
        }

        window.handleAuth = async () => {
            const email = getEl('email').value;
            const pass = getEl('password').value;
            const isLogin = getEl('auth-title').innerText === 'LOGIN';
            if(!email || !pass) return;

            getEl('loading-overlay').classList.remove('hidden');
            try {
                if (isLogin) await signInWithEmailAndPassword(auth, email, pass);
                else await createUserWithEmailAndPassword(auth, email, pass);
            } catch (e) { 
                let errorMsg = "Terjadi kesalahan.";
                if (e.code === 'auth/invalid-credential') errorMsg = "Email atau password salah.";
                showConfirmModal(`<span class="text-rose-500 font-bold">Gagal</span><br><span class="text-[10px]">${errorMsg}</span>`, () => {});
            } finally { getEl('loading-overlay').classList.add('hidden'); }
        };

        window.handleGuestLogin = async () => {
            getEl('loading-overlay').classList.remove('hidden');
            try { await signInAnonymously(auth); } 
            catch (e) { console.error(e); } 
            finally { getEl('loading-overlay').classList.add('hidden'); }
        };

        window.logout = () => {
            if(unsubscribeTrades) unsubscribeTrades();
            signOut(auth);
        };

        onAuthStateChanged(auth, async (user) => {
            getEl('loading-overlay').classList.add('hidden');
            if (user) { currentUser = user; checkAccount(); } 
            else { currentUser = null; showSection('auth-section'); }
        });

        async function checkAccount() {
            getEl('loading-overlay').classList.remove('hidden');
            try {
                const docSnap = await getDoc(doc(db, "users", currentUser.uid, "settings", "account"));
                if (docSnap.exists()) {
                    accountData = docSnap.data();
                    startDataListener();
                } else { showSection('account-section'); }
            } catch (e) { showSection('account-section'); }
            finally { getEl('loading-overlay').classList.add('hidden'); }
        }

        window.saveAccount = async (e) => {
            e.preventDefault();
            getEl('loading-overlay').classList.remove('hidden');
            const data = {
                name: getEl('acc-name').value,
                balance: parseFloat(getEl('acc-balance').value),
                currency: getEl('acc-currency').value,
                createdAt: new Date().toISOString()
            };
            try {
                await setDoc(doc(db, "users", currentUser.uid, "settings", "account"), data);
                accountData = data;
                startDataListener();
            } catch (e) { console.error(e); }
            finally { getEl('loading-overlay').classList.add('hidden'); }
        };

        function startDataListener() {
            if(unsubscribeTrades) unsubscribeTrades();
            const q = query(collection(db, "users", currentUser.uid, "trades"), orderBy("date", "asc"));
            unsubscribeTrades = onSnapshot(q, (snapshot) => {
                allTrades = [];
                snapshot.forEach(doc => allTrades.push({id: doc.id, ...doc.data()}));
                updateUI();
                if(!editingTradeId) showSection('dashboard-section');
                updateNavIcons('dashboard');
            });
        }

        function updateNavIcons(target) {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                const icon = link.querySelector('i');
                const span = link.querySelector('span');
                const isActive = link.dataset.target === target;
                if (icon) icon.className = `w-5 h-5 transition-all ${isActive ? 'text-blue-400 scale-110' : 'text-slate-500'}`;
                if (span) span.className = `text-[8px] font-black uppercase tracking-widest transition-all ${isActive ? 'text-blue-400 opacity-100' : 'text-slate-500 opacity-60'}`;
            });
        }

        window.navigateTo = (target) => {
            if(target === 'journal' && !editingTradeId) resetTradeForm();
            showSection(target + '-section');
            updateNavIcons(target);
        };

        function renderEquityCurve(trades) {
            const svg = getEl('equity-curve-svg');
            if (!svg) return;

            let currentBal = accountData?.balance || 0;
            const points = [currentBal];
            
            const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
            sortedTrades.forEach(t => {
                currentBal += t.pnl;
                points.push(currentBal);
            });

            if (points.length < 2) {
                svg.innerHTML = '';
                return;
            }

            const width = 400;
            const height = 100;
            const max = Math.max(...points);
            const min = Math.min(...points);
            const range = max - min === 0 ? 1 : max - min;
            
            const coords = points.map((p, i) => {
                const x = (i / (points.length - 1)) * width;
                const y = height - ((p - min) / range) * height;
                return `${x},${y}`;
            });

            const pathData = `M ${coords.join(' L ')}`;
            const areaData = `${pathData} L ${width},${height} L 0,${height} Z`;

            svg.innerHTML = `
                <defs>
                    <linearGradient id="curveGradient" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stop-color="#3b82f6" stop-opacity="0.3" />
                        <stop offset="100%" stop-color="#3b82f6" stop-opacity="0" />
                    </linearGradient>
                </defs>
                <path d="${areaData}" fill="url(#curveGradient)" />
                <path d="${pathData}" fill="none" stroke="#60a5fa" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="filter: drop-shadow(0 0 4px rgba(59, 130, 246, 0.5))" />
            `;
        }

        function updateUI() {
            const totalPnL = allTrades.reduce((sum, t) => sum + t.pnl, 0);
            const initialBalance = accountData?.balance || 0;
            const currentBalance = initialBalance + totalPnL;
            const wins = allTrades.filter(t => t.pnl > 0).length;
            const winRate = allTrades.length > 0 ? ((wins / allTrades.length) * 100).toFixed(1) : 0;
            
            // Hitung persentase pertumbuhan akun
            const growthPercentage = initialBalance > 0 ? ((totalPnL / initialBalance) * 100).toFixed(2) : 0;

            document.querySelectorAll('.val-balance').forEach(el => el.innerText = currentBalance.toLocaleString('id-ID'));
            document.querySelectorAll('.val-pnl').forEach(el => {
                el.innerText = (totalPnL >= 0 ? '+' : '') + totalPnL.toLocaleString('id-ID');
                el.className = `val-pnl font-black text-xl ${totalPnL >= 0 ? 'text-emerald-400' : 'text-rose-400'}`;
            });
            
            // Update persentase pertumbuhan di UI
            if(getEl('val-growth-pct')) {
                getEl('val-growth-pct').innerText = (totalPnL >= 0 ? '+' : '') + growthPercentage + '%';
                getEl('val-growth-pct').className = `text-[9px] font-black ${totalPnL >= 0 ? 'text-emerald-400/80' : 'text-rose-400/80'} ml-1`;
            }

            if(getEl('val-winrate')) getEl('val-winrate').innerText = winRate + '%';
            if(getEl('val-total-trades')) getEl('val-total-trades').innerText = allTrades.length;
            if(getEl('display-acc-name')) getEl('display-acc-name').innerText = accountData?.name || "Trader";

            renderEquityCurve(allTrades);

            const container = getEl('trades-list');
            const dashboardContainer = getEl('dashboard-trades-list');
            if(!container) return;

            const displayTrades = [...allTrades].sort((a,b) => new Date(b.date) - new Date(a.date));

            const renderTradeItem = (t) => `
                <div class="bg-white/5 p-4 rounded-2xl mb-3 border border-white/5 hover:border-white/10 transition-all">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-3 cursor-pointer flex-1" onclick="showTradeDetail('${t.id}')">
                            <div class="w-10 h-10 rounded-xl flex items-center justify-center ${t.pnl >= 0 ? 'bg-emerald-500/10 text-emerald-500' : 'bg-rose-500/10 text-rose-500'}">
                                <i data-lucide="${t.pnl >= 0 ? 'trending-up' : 'trending-down'}" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <p class="font-bold text-white text-sm">${t.pair} <span class="text-[8px] ml-1 px-1.5 py-0.5 rounded font-black ${t.type === 'BUY' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">${t.type}</span></p>
                                <p class="text-[9px] text-slate-500">${new Date(t.date).toLocaleDateString('id-ID', {dateStyle:'medium'})}</p>
                            </div>
                        </div>
                        <div class="text-right flex flex-col items-end gap-1">
                            <p class="font-black text-sm ${t.pnl >= 0 ? 'text-emerald-400' : 'text-rose-400'}">${t.pnl >= 0 ? '+' : ''}${t.pnl.toLocaleString('id-ID')}</p>
                            <div class="flex gap-2">
                                <button onclick="editTrade('${t.id}')" class="text-slate-600 hover:text-blue-400 transition-colors"><i data-lucide="edit-3" class="w-3 h-3"></i></button>
                                <button onclick="deleteTrade('${t.id}')" class="text-slate-600 hover:text-rose-500 transition-colors"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            if (displayTrades.length === 0) {
                const emptyMsg = `<div class="text-center py-12 bg-white/5 rounded-3xl border border-dashed border-white/10"><p class="text-slate-500 text-[10px] font-bold uppercase tracking-widest">Belum ada aktivitas</p></div>`;
                container.innerHTML = emptyMsg;
                if(dashboardContainer) dashboardContainer.innerHTML = emptyMsg;
            } else {
                container.innerHTML = displayTrades.map(t => renderTradeItem(t)).join('');
                if(dashboardContainer) dashboardContainer.innerHTML = displayTrades.slice(0, 3).map(t => renderTradeItem(t)).join('');
            }
            lucide.createIcons();
        }

        window.showTradeDetail = (id) => {
            const t = allTrades.find(trade => trade.id === id);
            if(!t) return;
            
            getEl('detail-pair').innerText = t.pair;
            getEl('detail-type').innerText = t.type;
            getEl('detail-type').className = `text-[10px] px-2 py-0.5 rounded font-black ${t.type === 'BUY' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}`;
            getEl('detail-date').innerText = new Date(t.date).toLocaleDateString('id-ID', { dateStyle: 'full' });
            getEl('detail-entry').innerText = t.entry || '-';
            getEl('detail-exit').innerText = t.exit || '-';
            getEl('detail-pnl').innerText = (t.pnl >= 0 ? '+' : '') + t.pnl.toLocaleString('id-ID');
            getEl('detail-pnl').className = `text-lg font-black ${t.pnl >= 0 ? 'text-emerald-400' : 'text-rose-400'}`;
            getEl('detail-notes').innerText = t.notes || 'Tidak ada catatan.';
            
            const imgContainer = getEl('detail-image-container');
            if(t.image) {
                imgContainer.innerHTML = `<img src="${t.image}" class="w-full rounded-xl border border-white/10 mt-2 shadow-lg">`;
                imgContainer.classList.remove('hidden');
            } else {
                imgContainer.classList.add('hidden');
            }

            getEl('detail-modal').classList.replace('hidden', 'flex');
        };

        window.hideTradeDetail = () => {
            getEl('detail-modal').classList.replace('flex', 'hidden');
        };

        window.handleImageUpload = (event) => {
            const file = event.target.files[0];
            if (!file) return;
            if (file.size > 800 * 1024) { 
                showConfirmModal(`<span class="text-rose-500">Gambar Terlalu Besar</span><br><span class="text-[10px]">Max 800KB untuk performa optimal.</span>`, () => {});
                event.target.value = '';
                return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
                selectedImageBase64 = e.target.result;
                getEl('image-preview').src = selectedImageBase64;
                getEl('image-preview-container').classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        };

        window.removeSelectedImage = () => {
            selectedImageBase64 = null;
            getEl('image-preview-container').classList.add('hidden');
            getEl('t-image').value = '';
        }

        window.editTrade = (id) => {
            const t = allTrades.find(trade => trade.id === id);
            if(!t) return;
            
            editingTradeId = id;
            getEl('journal-title').innerText = "Edit Trade";
            getEl('commit-btn').innerText = "Update Trade";
            
            getEl('t-date').value = t.date;
            getEl('t-pair').value = t.pair;
            getEl('t-type').value = t.type;
            getEl('t-entry').value = t.entry;
            getEl('t-exit').value = t.exit;
            getEl('t-pnl').value = t.pnl;
            getEl('t-notes').value = t.notes;
            
            if(t.image) {
                selectedImageBase64 = t.image;
                getEl('image-preview').src = t.image;
                getEl('image-preview-container').classList.remove('hidden');
            } else {
                removeSelectedImage();
            }

            navigateTo('journal');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.resetTradeForm = () => {
            editingTradeId = null;
            getEl('journal-title').innerText = "Trade Logs";
            getEl('commit-btn').innerText = "Commit Trade";
            getEl('trade-form').reset();
            removeSelectedImage();
            setDefaultDate();
        };

        window.addTrade = async (e) => {
            e.preventDefault();
            getEl('loading-overlay').classList.remove('hidden');
            const trade = {
                pair: getEl('t-pair').value.toUpperCase(),
                type: getEl('t-type').value,
                entry: parseFloat(getEl('t-entry').value) || 0,
                exit: parseFloat(getEl('t-exit').value) || 0,
                pnl: parseFloat(getEl('t-pnl').value) || 0,
                notes: getEl('t-notes').value || "",
                image: selectedImageBase64 || null,
                date: getEl('t-date').value
            };
            try {
                if(editingTradeId) {
                    await updateDoc(doc(db, "users", currentUser.uid, "trades", editingTradeId), trade);
                } else {
                    await addDoc(collection(db, "users", currentUser.uid, "trades"), trade);
                }
                resetTradeForm();
                navigateTo('dashboard');
            } catch (e) { console.error(e); }
            finally { getEl('loading-overlay').classList.add('hidden'); }
        };

        window.deleteTrade = (id) => {
            showConfirmModal("Hapus trade ini?", async () => {
                await deleteDoc(doc(db, "users", currentUser.uid, "trades", id));
            });
        };

        window.deleteAllTrades = () => {
            showConfirmModal("⚠️ HAPUS SEMUA DATA?", async () => {
                const snapshot = await getDocs(collection(db, "users", currentUser.uid, "trades"));
                const batch = writeBatch(db);
                snapshot.forEach(doc => batch.delete(doc.ref));
                await batch.commit();
            });
        };

        let confirmAction = null;
        function showConfirmModal(msg, action) {
            getEl('modal-msg').innerHTML = msg;
            getEl('confirm-modal').classList.replace('hidden', 'flex');
            confirmAction = action;
        }
        window.hideConfirmModal = () => {
            getEl('confirm-modal').classList.replace('flex', 'hidden');
            confirmAction = null;
        }
        window.executeConfirm = () => {
            if(confirmAction) confirmAction();
            hideConfirmModal();
        }

        window.changeMonth = (val) => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + val);
            renderCalendar();
        };

        function renderCalendar() {
            const container = getEl('calendar-grid');
            const monthLabel = getEl('current-month-label');
            const monthPnlDisplay = getEl('month-pnl-display');
            if(!container || !monthLabel) return;
            
            container.innerHTML = '';
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            monthLabel.innerText = new Intl.DateTimeFormat('id-ID', { month: 'long', year: 'numeric' }).format(currentCalendarDate);
            
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            
            const pnlByDate = {};
            let monthTotalPnL = 0;

            allTrades.forEach(t => {
                const d = new Date(t.date);
                if(d.getFullYear() === year && d.getMonth() === month) {
                    const dayKey = d.getDate();
                    pnlByDate[dayKey] = (pnlByDate[dayKey] || 0) + t.pnl;
                    monthTotalPnL += t.pnl;
                }
            });

            const days = ['MIN', 'SEN', 'SEL', 'RAB', 'KAM', 'JUM', 'SAB', 'PNL/W'];
            days.forEach(day => {
                container.innerHTML += `<div class="text-[8px] font-black text-slate-600 text-center pb-2">${day}</div>`;
            });

            let currentWeekPnL = 0;
            let dayCount = 0;

            for(let i=0; i<firstDay; i++) {
                container.innerHTML += `<div></div>`;
                dayCount++;
            }

            for(let day=1; day<=lastDate; day++) {
                const p = pnlByDate[day];
                if (p !== undefined) currentWeekPnL += p;
                const bg = p !== undefined ? (p > 0 ? 'bg-emerald-500/10 border-emerald-500/20' : 'bg-rose-500/10 border-rose-500/20') : 'bg-white/5 border-white/5';
                
                container.innerHTML += `
                    <div class="aspect-square flex flex-col items-center justify-center rounded-xl border ${bg} text-[10px] font-bold relative overflow-hidden">
                        <span class="text-slate-500 text-[8px] absolute top-1 left-1.5">${day}</span>
                        ${p !== undefined ? `<span class="${p>0?'text-emerald-400':'text-rose-400'} text-[7px] leading-tight px-1 text-center mt-1">${p>0?'+':''}${p.toFixed(1)}</span>` : ''}
                    </div>
                `;
                dayCount++;

                if (dayCount % 8 === 7) {
                    const wColor = currentWeekPnL > 0 ? 'text-emerald-400' : (currentWeekPnL < 0 ? 'text-rose-400' : 'text-slate-600');
                    container.innerHTML += `<div class="aspect-square flex items-center justify-center rounded-xl bg-blue-500/5 border border-blue-500/10"><span class="${wColor} text-[8px] font-black text-center">${currentWeekPnL !== 0 ? (currentWeekPnL > 0 ? '+' : '') + currentWeekPnL.toFixed(1) : '-'}</span></div>`;
                    currentWeekPnL = 0;
                    dayCount++;
                }
            }

            while (dayCount % 8 !== 7) { container.innerHTML += `<div></div>`; dayCount++; }
            const finalWColor = currentWeekPnL > 0 ? 'text-emerald-400' : (currentWeekPnL < 0 ? 'text-rose-400' : 'text-slate-600');
            container.innerHTML += `<div class="aspect-square flex items-center justify-center rounded-xl bg-blue-500/5 border border-blue-500/10"><span class="${finalWColor} text-[8px] font-black text-center">${currentWeekPnL !== 0 ? (currentWeekPnL > 0 ? '+' : '') + currentWeekPnL.toFixed(1) : '-'}</span></div>`;

            if (monthPnlDisplay) {
                monthPnlDisplay.innerText = (monthTotalPnL >= 0 ? '+' : '') + monthTotalPnL.toLocaleString('id-ID', { minimumFractionDigits: 1, maximumFractionDigits: 1 });
                monthPnlDisplay.className = `text-lg font-black ${monthTotalPnL >= 0 ? 'text-emerald-400' : 'text-rose-400'}`;
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        :root { --bg: #020617; }
        body { background-color: var(--bg); color: #f8fafc; font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; }
        .hidden { display: none; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); }
        input, select, textarea { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 1rem; padding: 0.75rem 1rem; color: #f1f5f9; width: 100%; font-size: 0.85rem; transition: all 0.2s; }
        input:focus, textarea:focus { outline: none; border-color: #3b82f6; background: rgba(30, 41, 59, 0.8); }
        textarea { resize: none; min-height: 80px; }
        .btn-primary { background: linear-gradient(135deg, #3b82f6, #2563eb); transition: transform 0.1s; color: white; }
        .btn-primary:active { transform: scale(0.97); }
        
        #equity-curve-svg path {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: dash 2s ease-out forwards;
        }
        @keyframes dash { to { stroke-dashoffset: 0; } }
    </style>
</head>
<body class="min-h-screen pb-24 text-slate-200">

    <!-- MODAL DETAIL TRADE -->
    <div id="detail-modal" class="hidden fixed inset-0 bg-slate-950/90 backdrop-blur-md z-[200] items-center justify-center p-6">
        <div class="bg-slate-900 border border-white/10 rounded-[2.5rem] w-full max-w-sm overflow-hidden shadow-2xl flex flex-col max-h-[90vh]">
            <div class="p-6 overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 id="detail-pair" class="text-2xl font-black text-white italic">GOLD</h3>
                        <span id="detail-type">BUY</span>
                    </div>
                    <button onclick="hideTradeDetail()" class="w-10 h-10 bg-white/5 rounded-full flex items-center justify-center text-slate-400"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
                
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white/5 p-3 rounded-2xl">
                            <p class="text-[8px] font-black uppercase text-slate-500 mb-1">Entry Price</p>
                            <p id="detail-entry" class="font-bold text-white">-</p>
                        </div>
                        <div class="bg-white/5 p-3 rounded-2xl">
                            <p class="text-[8px] font-black uppercase text-slate-500 mb-1">Exit Price</p>
                            <p id="detail-exit" class="font-bold text-white">-</p>
                        </div>
                    </div>
                    <div class="bg-white/5 p-4 rounded-2xl flex justify-between items-center">
                        <p class="text-[8px] font-black uppercase text-slate-500">Hasil PnL</p>
                        <p id="detail-pnl" class="text-xl font-black">+0</p>
                    </div>
                    <div class="bg-white/5 p-4 rounded-2xl">
                        <p class="text-[8px] font-black uppercase text-slate-500 mb-2">Tanggal Eksekusi</p>
                        <p id="detail-date" class="text-[10px] font-bold text-white uppercase italic">-</p>
                    </div>
                    <div class="bg-white/5 p-4 rounded-2xl">
                        <p class="text-[8px] font-black uppercase text-slate-500 mb-2">Evaluasi & Catatan</p>
                        <p id="detail-notes" class="text-xs text-slate-300 leading-relaxed"></p>
                    </div>
                    <div id="detail-image-container" class="hidden"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL KONFIRMASI -->
    <div id="confirm-modal" class="hidden fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-[200] items-center justify-center p-6">
        <div class="bg-slate-900 border border-white/10 p-8 rounded-[2rem] w-full max-w-xs text-center space-y-6 shadow-2xl">
            <p id="modal-msg" class="text-sm font-bold text-white uppercase tracking-tight"></p>
            <div class="flex flex-col gap-2">
                <button onclick="executeConfirm()" class="w-full bg-rose-600 py-3 rounded-xl font-black text-white text-xs uppercase tracking-widest">Ya, Lanjutkan</button>
                <button onclick="hideConfirmModal()" class="w-full bg-slate-800 py-3 rounded-xl font-black text-slate-400 text-xs uppercase tracking-widest">Batal</button>
            </div>
        </div>
    </div>

    <div id="loading-overlay" class="fixed inset-0 bg-slate-950 flex items-center justify-center z-[100]">
        <div class="h-16 w-16 rounded-full border-t-2 border-b-2 border-blue-500 animate-spin"></div>
    </div>

    <!-- AUTH SECTION -->
    <section id="auth-section" class="hidden min-h-screen flex items-center justify-center p-8 bg-[radial-gradient(circle_at_top,#1e293b,transparent)]">
        <div class="w-full max-w-sm text-center">
            <div class="mb-10 inline-block p-4 bg-blue-600/10 rounded-3xl border border-blue-500/20 rotate-3"><i data-lucide="shield-check" class="text-blue-500 w-10 h-10 -rotate-3"></i></div>
            <h1 id="auth-title" class="text-3xl font-black italic uppercase tracking-tighter mb-2 text-white">LOGIN</h1>
            <p class="text-slate-500 text-xs mb-8">Kelola perdagangan Anda dengan profesional</p>
            <div class="space-y-4 text-left">
                <div class="space-y-1"><label class="text-[10px] font-black text-slate-500 uppercase ml-2">Email</label><input id="email" type="email" placeholder="email@contoh.com"></div>
                <div class="space-y-1"><label class="text-[10px] font-black text-slate-500 uppercase ml-2">Password</label><div class="relative"><input id="password" type="password" placeholder="••••••••"><button onclick="togglePassword('password', 'pass-icon')" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500"><i id="pass-icon" data-lucide="eye" class="w-4 h-4"></i></button></div></div>
                <button id="auth-submit-btn" onclick="handleAuth()" class="w-full btn-primary py-4 rounded-2xl font-black shadow-xl shadow-blue-500/20 text-sm">MASUK</button>
                <div class="pt-4 space-y-3"><button onclick="toggleAuthMode()" id="auth-toggle-text" class="w-full text-slate-500 text-[11px] font-bold hover:text-blue-400 transition-colors">Belum punya akun? Daftar</button><div class="flex items-center gap-4 py-2"><div class="h-px bg-slate-800 flex-1"></div><span class="text-[9px] text-slate-600 font-black uppercase">Atau</span><div class="h-px bg-slate-800 flex-1"></div></div><button onclick="handleGuestLogin()" class="w-full bg-white/5 border border-white/5 py-3 rounded-2xl font-black text-slate-400 text-[10px] uppercase tracking-widest hover:bg-white/10">Masuk sebagai Tamu</button></div>
            </div>
        </div>
    </section>

    <!-- SETUP ACCOUNT SECTION -->
    <section id="account-section" class="hidden min-h-screen flex items-center justify-center p-6 bg-[radial-gradient(circle_at_bottom,#1e293b,transparent)]">
        <div class="w-full max-w-sm">
            <button onclick="logout()" class="mb-6 flex items-center gap-2 text-slate-500 hover:text-white transition-colors text-[10px] font-black uppercase tracking-widest group">
                <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i> Kembali ke Login
            </button>
            <div class="glass p-8 rounded-[2.5rem] border border-white/5 shadow-2xl">
                <h2 class="text-xl font-black mb-6 uppercase italic flex items-center gap-2 text-white">
                    <i data-lucide="settings-2" class="w-5 h-5 text-blue-500"></i> Setup Profil
                </h2>
                <form onsubmit="saveAccount(event)" class="space-y-5">
                    <div class="space-y-1">
                        <label class="text-[9px] font-black text-slate-500 uppercase ml-2">Identitas Portofolio</label>
                        <input id="acc-name" placeholder="Nama Akun (Broker/Personal)" required>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[9px] font-black text-slate-500 uppercase ml-2">Modal Awal</label>
                        <input id="acc-balance" type="number" step="0.01" placeholder="0.00" required>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[9px] font-black text-slate-500 uppercase ml-2">Mata Uang</label>
                        <select id="acc-currency"><option value="USD">USD ($)</option><option value="IDR">IDR (Rp)</option></select>
                    </div>
                    <button type="submit" class="w-full btn-primary py-4 rounded-2xl font-black uppercase tracking-widest text-xs shadow-lg shadow-blue-500/20 mt-4 text-white">Mulai Jurnal</button>
                </form>
            </div>
        </div>
    </section>

    <!-- DASHBOARD SECTION -->
    <section id="dashboard-section" class="hidden p-6 max-w-2xl mx-auto space-y-6">
        <div class="flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-600 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/20"><i data-lucide="user" class="w-5 h-5 text-white"></i></div>
                <div><p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Akun Aktif</p><h1 id="display-acc-name" class="text-sm font-bold text-white uppercase italic">Trader</h1></div>
            </div>
            <button onclick="logout()" class="w-10 h-10 bg-white/5 border border-white/5 rounded-xl flex items-center justify-center text-slate-400 hover:text-rose-500 transition-colors"><i data-lucide="power" class="w-4 h-4"></i></button>
        </div>

        <!-- EQUITY CARD -->
        <div class="relative overflow-hidden bg-gradient-to-br from-blue-600 to-indigo-900 rounded-[2.5rem] shadow-2xl shadow-blue-900/30">
            <div class="p-8 relative z-10">
                <p class="text-blue-100/60 text-[10px] font-black uppercase tracking-[0.2em] mb-2">Total Equity</p>
                <h2 class="text-4xl font-black mb-10 tracking-tighter text-white"><span class="val-balance">0</span></h2>
                <div class="w-full h-24 mt-4 relative">
                    <svg id="equity-curve-svg" viewBox="0 0 400 100" preserveAspectRatio="none" class="w-full h-full"></svg>
                </div>
                <div class="grid grid-cols-2 gap-4 mt-6">
                    <div class="bg-black/20 backdrop-blur-md p-4 rounded-2xl border border-white/5">
                        <div class="flex items-center justify-between mb-1">
                            <p class="text-white/40 text-[8px] font-black uppercase tracking-widest">Growth</p>
                            <span id="val-growth-pct" class="text-[9px] font-black text-emerald-400/80 ml-1">+0%</span>
                        </div>
                        <p class="val-pnl font-black text-lg">+0</p>
                    </div>
                    <div class="bg-black/20 backdrop-blur-md p-4 rounded-2xl border border-white/5"><p class="text-white/40 text-[8px] font-black uppercase mb-1 tracking-widest">Win Rate</p><p id="val-winrate" class="font-black text-lg text-white">0%</p></div>
                </div>
            </div>
            <div class="absolute -bottom-10 -right-10 w-40 h-40 bg-blue-400/20 blur-[80px]"></div>
        </div>

        <!-- RECENT TRADES AT DASHBOARD -->
        <div class="space-y-4">
            <div class="flex justify-between items-center">
                <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Aktivitas Terakhir</h3>
                <button onclick="navigateTo('journal')" class="text-[10px] font-black text-blue-400 uppercase tracking-widest">Lihat Semua</button>
            </div>
            <div id="dashboard-trades-list" class="space-y-3"></div>
        </div>

        <button onclick="navigateTo('journal')" class="w-full btn-primary p-5 rounded-[2rem] flex items-center justify-between shadow-xl shadow-blue-500/10 group text-white">
            <div class="flex items-center gap-4"><div class="bg-white/20 w-10 h-10 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform"><i data-lucide="plus" class="w-5 h-5 text-white"></i></div><span class="font-black uppercase italic tracking-tight text-white">Open New Journal</span></div>
            <i data-lucide="chevron-right" class="w-5 h-5 text-white/40"></i>
        </button>
    </section>

    <!-- RECAP SECTION -->
    <section id="recap-section" class="hidden p-6 max-w-2xl mx-auto space-y-6">
        <div class="flex items-center justify-between">
            <h2 class="text-xl font-black uppercase italic tracking-tight flex items-center gap-2"><i data-lucide="calendar" class="w-5 h-5 text-blue-500"></i> Trading Recap</h2>
            <div class="flex items-center gap-2 bg-white/5 p-1.5 rounded-xl border border-white/5">
                <button onclick="changeMonth(-1)" class="p-1.5 hover:bg-white/10 rounded-lg"><i data-lucide="chevron-left" class="w-4 h-4 text-slate-400"></i></button>
                <span id="current-month-label" class="text-[9px] font-black uppercase tracking-widest w-24 text-center text-slate-200">BULAN</span>
                <button onclick="changeMonth(1)" class="p-1.5 hover:bg-white/10 rounded-lg"><i data-lucide="chevron-right" class="w-4 h-4 text-slate-400"></i></button>
            </div>
        </div>
        <div id="calendar-grid" class="grid grid-cols-8 gap-1.5 bg-white/5 p-4 rounded-[2rem] border border-white/5"></div>
        <div class="bg-white/5 border border-white/5 p-6 rounded-[2rem] flex flex-col items-center justify-center"><p class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] mb-1">Monthly Performance</p><div id="month-pnl-display" class="text-lg font-black">+0.0</div></div>
    </section>

    <!-- JOURNAL SECTION -->
    <section id="journal-section" class="hidden p-6 max-w-2xl mx-auto space-y-8">
        <h2 id="journal-title" class="text-xl font-black uppercase italic tracking-tight flex items-center gap-2"><i data-lucide="book-marked" class="w-5 h-5 text-blue-500"></i> Trade Logs</h2>
        
        <form id="trade-form" onsubmit="addTrade(event)" class="bg-white/5 p-6 rounded-[2.5rem] border border-white/5 space-y-4">
            <div class="space-y-1"><label class="text-[9px] font-black text-slate-500 uppercase ml-2 tracking-widest">Waktu Trade</label><input id="t-date" type="date" required></div>
            <div class="grid grid-cols-2 gap-3"><input id="t-pair" placeholder="Simbol (Contoh: GOLD)" required><select id="t-type" class="font-bold"><option value="BUY">BUY</option><option value="SELL">SELL</option></select></div>
            <div class="grid grid-cols-2 gap-3"><input id="t-entry" type="number" step="0.0000001" placeholder="Entry Price"><input id="t-exit" type="number" step="0.0000001" placeholder="Exit Price"></div>
            
            <div class="space-y-1">
                <label class="text-[9px] font-black text-slate-500 uppercase ml-2 tracking-widest">Screenshot Setup (Optional)</label>
                <div class="relative">
                    <input id="t-image" type="file" accept="image/*" onchange="handleImageUpload(event)" class="hidden">
                    <label for="t-image" class="w-full flex items-center justify-center gap-2 bg-white/5 border border-dashed border-white/20 p-4 rounded-2xl cursor-pointer hover:bg-white/10 transition-all">
                        <i data-lucide="image-plus" class="w-4 h-4 text-blue-400"></i>
                        <span class="text-[10px] font-black uppercase text-slate-400">Pilih Gambar</span>
                    </label>
                </div>
                <div id="image-preview-container" class="hidden relative mt-2 rounded-2xl overflow-hidden border border-white/10">
                    <img id="image-preview" class="w-full h-40 object-cover opacity-70">
                    <button type="button" onclick="removeSelectedImage()" class="absolute top-2 right-2 bg-rose-600 p-1.5 rounded-lg text-white"><i data-lucide="x" class="w-3 h-3"></i></button>
                </div>
            </div>

            <div class="space-y-1"><label class="text-[9px] font-black text-slate-500 uppercase ml-2 tracking-widest">Hasil Akhir (PnL)</label><input id="t-pnl" type="number" step="0.01" placeholder="Cth: 50.5" required class="border-blue-500/30"></div>
            <div class="space-y-1"><label class="text-[9px] font-black text-slate-500 uppercase ml-2 tracking-widest">Catatan</label><textarea id="t-notes" placeholder="Berikan alasan entry, emosi, atau evaluasi..."></textarea></div>
            
            <div class="flex gap-2">
                <button type="submit" id="commit-btn" class="flex-1 btn-primary py-4 rounded-2xl font-black uppercase text-xs shadow-lg tracking-widest mt-2 text-white">Commit Trade</button>
                <button type="button" onclick="resetTradeForm()" class="bg-white/5 border border-white/5 px-6 rounded-2xl font-black text-slate-500 text-[10px] uppercase mt-2">Batal</button>
            </div>
        </form>

        <div class="flex justify-between items-center">
            <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]">History Trade</h3>
            <button onclick="deleteAllTrades()" class="text-[8px] font-black text-rose-500/50 uppercase tracking-widest flex items-center gap-1 hover:text-rose-500 transition-colors"><i data-lucide="trash-2" class="w-3 h-3"></i> Clear All</button>
        </div>
        <div id="trades-list" class="space-y-3 pb-20"></div>
    </section>

    <!-- NAVIGATION BAR -->
    <nav id="main-nav" class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 glass w-[90%] max-w-sm border border-white/10 rounded-[2.5rem] p-2 flex justify-between z-50 shadow-2xl">
        <button onclick="navigateTo('dashboard')" data-target="dashboard" class="nav-link flex-1 flex flex-col items-center gap-1 py-2">
            <i data-lucide="layout-dashboard" class="w-5 h-5 text-blue-400"></i><span class="text-[8px] font-black uppercase text-blue-400 tracking-widest">Home</span>
        </button>
        <button onclick="navigateTo('recap')" data-target="recap" class="nav-link flex-1 flex flex-col items-center gap-1 py-2">
            <i data-lucide="calendar-days" class="w-5 h-5 text-slate-500"></i><span class="text-[8px] font-black uppercase text-slate-500 tracking-widest">Recap</span>
        </button>
        <button onclick="navigateTo('journal')" data-target="journal" class="nav-link flex-1 flex flex-col items-center gap-1 py-2">
            <i data-lucide="pencil-line" class="w-5 h-5 text-slate-500"></i><span class="text-[8px] font-black uppercase text-slate-500 tracking-widest">Journal</span>
        </button>
    </nav>

    <script> window.onload = () => { lucide.createIcons(); }; </script>
</body>
</html>
